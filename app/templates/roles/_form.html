<!-- roles/_form.html -->
{{ form.hidden_tag() }}

<div class="mb-3">
    {{ form.name.label(class="form-label") }}
    {{ form.name(class="form-control") }}
    {% if form.name.errors %}
        <div class="text-danger small">
            {% for error in form.name.errors %}
                <div>{{ error }}</div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<div class="mb-3">
    {{ form.description.label(class="form-label") }}
    {{ form.description(class="form-control", rows="3") }}
    {% if form.description.errors %}
        <div class="text-danger small">
            {% for error in form.description.errors %}
                <div>{{ error }}</div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<div class="mb-3">
    {{ form.permission_ids.label(class="form-label") }}
    
    {% if form.permissions_by_module %}
        {% for module, perms in form.permissions_by_module.items() %}
            <div class="mb-3">
                <h6 class="text-muted">{{ module }}</h6>
                {% for perm in perms %}
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            name="permission_ids" 
                            value="{{ perm.id }}"
                            id="perm_{{ perm.id }}"
                            {% if perm.id in (form.permission_ids.data or []) %}checked{% endif %}
                        >
                        <label class="form-check-label" for="perm_{{ perm.id }}">
                            <code>{{ perm.code }}</code> - {{ perm.name }}
                        </label>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No permissions available</p>
    {% endif %}
    
    {% if form.permission_ids.errors %}
        <div class="text-danger small">
            {% for error in form.permission_ids.errors %}
                <div>{{ error }}</div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<div class="mt-4">
    {{ form.submit(class="btn btn-primary") }}
    <a href="{{ url_for('tbl_roles.index') }}" class="btn btn-outline-secondary">
        Cancel
    </a>
</div>